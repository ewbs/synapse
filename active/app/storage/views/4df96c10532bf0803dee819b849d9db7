<?php
$lastRevision=($eform) ? $eform->getLastRevisionEform() : null;
$aPiecesStates = DemarchePieceState::all ();
$current_state = Input::old('current_state', $lastRevision ? $lastRevision->current_state_id : '');
$next_state = Input::old('next_state', $lastRevision ? $lastRevision->next_state_id : '');
?>


<?php $__env->startSection('title'); ?>Intégration du formulaire <em><span class="text-primary"><?php echo ManageableModel::formatId($nostraForm->nostra_id); ?></span> <?php echo $nostraForm->title; ?></em> <?php $__env->stopSection(); ?>
<?php $__env->startSection('content'); ?>
<div class="row">
	<div class="col-md-4">
		<div class="block-flat">
			<div class="header"><h3>Données Nostra</h3></div>
			<div class="content">
				<p>
					<strong>Id slot : </strong><?php echo ManageableModel::formatId($nostraForm->form_id); ?><br/>
					<strong>Langue : </strong><?php echo $nostraForm->language; ?><br/>
					<strong>Priorité : </strong><?php echo $nostraForm->priority; ?><br/>
					<strong>Format : </strong><?php echo $nostraForm->format; ?><br/>
					<strong>Url : </strong><a href="<?php echo $nostraForm->url; ?>" target="_blank"><?php echo $nostraForm->url; ?></a><br/>
					<strong>Formulaire intelligent : </strong><?php if($nostraForm->smart >0): ?> oui <?php else: ?> non <?php endif; ?><br/>
					<strong>Signable électroniquement : </strong><?php if($nostraForm->esign >0): ?> oui <?php else: ?> non <?php endif; ?><br/>
					<strong>Simplifié : </strong><?php if($nostraForm->simplified > 0): ?> oui <?php else: ?> non <?php endif; ?>
				</p>
			</div>
		</div>
	</div>
	<div class="col-md-8">
		<div class="block-flat">
			<div class="header">
				<h3>
					<?php if(is_object($eform)): ?>
						Vous avez choisi de <span class="text-primary">fusionner ce formulaire</span> Nostra avec un formulaire existant dans Synapse
					<?php else: ?>
						Vous avez choisi de <span class="text-primary">créer un nouveau formulaire</span> dans Synapse sur base de ce formulaire Nostra
					<?php endif; ?>
				</h3>
			</div>
			<div class="content">
				<h4>
					Résultat de cette opération :
				</h4>
				<?php if(is_object($eform)): ?>
					<p>Le formulaire présent dans Synapse va être fusionné avec ce formulaire Nostra.</p>
					<?php
						$changes = [];
						if ($nostraForm->form_id	!= $eform->form_id) 	{ array_push($changes, "L'id de slot va passer de <em>".(strlen($eform->form_id)?$eform->form_id:'indéfini')."</em> à <em>".$nostraForm->form_id."</em>."); }
						if ($nostraForm->title 		!= $eform->title) 		{ array_push($changes, "Le nom du formulaire va passer de <em>".(strlen($eform->title)?$eform->title:'indéfini')."</em> à <em>".$nostraForm->title."</em>."); }
						if ($nostraForm->language 	!= $eform->language)	{ array_push($changes, "La langue va passer de <em>".(strlen($eform->language)?$eform->language:'indéfini')."</em> à <em>".$nostraForm->language."</em>."); }
						if ($nostraForm->url 		!= $eform->url) 		{ array_push($changes, "L'url va passer de <em>".(strlen($eform->url)?$eform->url:'indéfini')."</em> à <em>".$nostraForm->url."</em>."); }
						if ($nostraForm->smart 		!= $eform->smart) 		{ array_push($changes, "Formulaire intelligent va passer de <em>".(strlen($eform->smart)?$eform->smart:'indéfini')."</em> à <em>".$nostraForm->smart."</em>."); }
						if ($nostraForm->priority 	!= $eform->priority)	{ array_push($changes, "La priorité va passer de <em>".(strlen($eform->priority)?$eform->priority:'indéfini')."</em> à <em>".$nostraForm->priority."</em>."); }
						if ($nostraForm->esign 		!= $eform->esign) 		{ array_push($changes, "La signature va passer de <em>".(strlen($eform->esign)?$eform->esign:'indéfini')."</em> à <em>".$nostraForm->esign."</em>."); }
						if ($nostraForm->format 	!= $eform->format) 		{ array_push($changes, "Le format va passer de <em>".(strlen($eform->format)?$eform->format:'indéfini')."</em> à <em>".$nostraForm->format."</em>."); }
						if ($nostraForm->simplified != $eform->simplified)	{ array_push($changes, "Simplifié va passer de <em>".(strlen($eform->simplified)?$eform->simplified:'indéfini')."</em> à <em>".$nostraForm->simplified."</em>."); }
					?>
					<?php if(count($changes)): ?>
						<p>Les modifications suivantes vont être apportées au formulaire existant :</p>
						<ul>
							<?php foreach($changes as $change): ?>
								<li><?php echo $change; ?></li>
							<?php endforeach; ?>
						</ul>
					<?php endif; ?>

				<?php else: ?>
					<p>Un nouveau eform va ête créé dans Synapse avec les informations tirées de Nostra (voir ci-dessus).</p>
				<?php endif; ?>

				<hr/>
				<form class="form-horizontal" method="post" autocomplete="off" action="<?php echo $nostraForm->routePostCreateValidation($nostraForm->id); ?>">
					<input type="hidden" name="_token" id="_token" value="<?php echo e(csrf_token()); ?>" />
					<input type="hidden" name="eform" id="eform" value="<?php echo $eform ? $eform->id : '-1'; ?>" />
					<div class="form-group <?php echo e($errors->has('description') ? 'has-error' : ''); ?>">
						<label class="col-md-2 control-label" for="name">Description</label>
						<div class="col-md-10">
							<textarea style="height: 100px;" class="form-control" name="description" id="description"><?php echo e(Input::old('description', $eform ? $eform->description : null)); ?></textarea>
							<?php echo $errors->first('description', '<span class="help-inline">:message</span>'); ?>

						</div>
					</div>

					<fieldset>
						<legend>Révision</legend>

						<div class="form-group">
							<label class="col-md-2 control-label" for="current_state">Etat courant</label>
							<div class="col-md-10">
								<select class="form-control" name="current_state" id="current_state">
									<option></option>
									<?php foreach($aPiecesStates as $item): ?>
										<option value="<?php echo $item->id; ?>"<?php echo $current_state==$item->id ?' selected':''; ?>><?php echo $item->code; ?> : <?php echo $item->name; ?></option>
									<?php endforeach; ?>
								</select>
							</div>
						</div>

						<div class="form-group">
							<label class="col-md-2 control-label" for="next_state">Etat suivant</label>
							<div class="col-md-10">
								<select class="form-control" name="next_state" id="next_state">
									<option></option>
									<?php foreach($aPiecesStates as $item): ?>
										<option value="<?php echo $item->id; ?>"<?php echo $next_state==$item->id ?' selected':''; ?>><?php echo $item->code; ?> : <?php echo $item->name; ?></option>
									<?php endforeach; ?>
								</select>
							</div>
						</div>

						<div class="form-group <?php echo e($errors->has('comment') ? 'has-error' : ''); ?>">
							<label class="col-md-2 control-label" for="comment">Commentaire</label>
							<div class="col-md-10">
								<textarea style="height: 100px;" class="form-control" name="comment" id="comment"><?php echo e(Input::old('comment', null)); ?></textarea>
								<?php echo $errors->first('comment', '<span class="help-inline">:message</span>'); ?>

							</div>
						</div>
					</fieldset>

					<div class="form-group">
						<div class="col-md-offset-2 col-md-10">
							<a class="btn btn-default" href="<?php echo $nostraForm->routeGetIndex(); ?>"><?php echo Lang::get('button.cancel'); ?></a>
							<button type="submit" class="btn btn-primary"><?php echo Lang::get('button.save'); ?></button>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<?php $__env->stopSection(); ?>
<?php echo $__env->make('site.layouts.container-fluid', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>