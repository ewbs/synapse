<?php 
/**
 * @var Illuminate\Database\Eloquent\Collection $regions
 * @var Illuminate\Database\Eloquent\Collection $publics
 * @var Illuminate\Database\Eloquent\Collection $taxonomyCategories
 * @var Illuminate\Database\Eloquent\Collection $expertises
 * @var array $selectedAdministrationsIds
 * @var array $selectedTagsIds
 * @var array $selectedPublicsIds
 * @var array $selectedExpertisesIds
 */
?>

<?php $__env->startSection('title'); ?>Mes filtres <?php $__env->stopSection(); ?>
<?php $__env->startSection('content'); ?>
    <div class="cl-mcont">
        <?php echo $__env->make('site.layouts.userdashboard-menu', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>


        <div class="row">

            <div class="col-md-12">
                <div class="block-flat">
                    <div class="header">
                        <h3>Mes filtres</h3>
                    </div>
                    <div class="content">
                        <p>
                            Les filtres vous permettent de personnaliser les données affichées dans Synapse.<br/>
                            Les filtres fontionnent par union puis par intersection.
                            <?php /* #desactivatedtags*/ ?><?php /*Par exemple, si vous sélectionnez les administrations "DGO6" et "DGO7", le public cible "citoyen" et les tags "cabinet" et "formulaires",*/ ?>
                            Par exemple, si vous sélectionnez les administrations "DGO6" et "DGO7" et le public cible "citoyen",
                            le filtre vous retournera les élements
                            <ul>
                                <li>relatifs à la DGO6 <strong>ou</strong> à la DGO7</li>
                                <li>et qui sont associés au public citoyen"</li>
                                <?php /* #desactivatedtags*/ ?><?php /*<li><strong>et</strong> qui possèdent le tag "cabinet" <strong>ou</strong> le tag "formulaires"*/ ?>
                            </ul>
                        </p>
                        <form method="post" autocomplete="off" action="<?php echo route('userPostFilters'); ?>">
                            <!-- CSRF Token -->
                            <input type="hidden" name="_token" id="_token" value="<?php echo e(csrf_token()); ?>" />
                            <!-- ./ csrf token -->
                            <div class="row">
                                <div class="col-md-4">
                                    <h4>Par administrations</h4>
                                    <p>N'afficher que les éléments relatifs à ces administrations:</p>
                                    <select class="select2" multiple name="administrations[]" id="administrations">
                                        <?php foreach($regions as $region): ?>
                                            <optgroup label="<?php echo $region->name; ?>">
                                                <?php foreach($region->administrations()->orderBy('name')->get() as $administration): ?>
                                                    <option
                                                            <?php echo in_array($administration->id, $selectedAdministrationsIds) ? 'selected' : ''; ?>

                                                            value="<?php echo $administration->id; ?>"><?php echo $administration->name; ?></option>
                                                <?php endforeach; ?>
                                            </optgroup>
                                        <?php endforeach; ?>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <h4>Par public cible</h4>
                                    <p>N'afficher que les éléments relatifs à ces publics :</p>
                                    <select class="select2" multiple name="publics[]" id="publics">
                                        <?php foreach($publics as $public): ?>
                                            <option
                                                    <?php echo in_array($public->id, $selectedPublicsIds) ? 'selected' : ''; ?>

                                                    value="<?php echo $public->id; ?>"><?php echo $public->title; ?></option>
                                        <?php endforeach; ?>
                                    </select>
                                </div>
                                <?php /* #desactivatedtags*/ ?>
                                <div class="col-md-4 hidden">
                                    <h4>Par tags</h4>
                                    <p>N'afficher que les éléments relatifs à ces tags :</p>
                                    <select class="select2" multiple name="tags[]" id="tags">
                                        <?php foreach($taxonomyCategories as $category): ?>
                                            <optgroup label="<?php echo $category->name; ?>">
                                                <?php foreach($category->tags as $tag): ?>
                                                    <option
                                                            <?php echo in_array($tag->id, $selectedTagsIds) ? 'selected' : ''; ?>

                                                            value="<?php echo $tag->id; ?>"><?php echo $tag->name; ?></option>
                                                <?php endforeach; ?>
                                            </optgroup>
                                        <?php endforeach; ?>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <h4>Par action (identification)</h4>
                                    <p>N'afficher que les éléments relatifs à ces actions :</p>
                                    <select class="select2" multiple name="expertises[]" id="expertises">
                                        <?php foreach($expertises as $expertise): ?>
                                            <option
                                                    <?php echo in_array($expertise->id, $selectedExpertisesIds) ? 'selected' : ''; ?>

                                                    value="<?php echo $expertise->id; ?>"><?php echo $expertise->name; ?></option>
                                        <?php endforeach; ?>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <input class="btn btn-primary" type="submit" value="Sauvegarder mes filtres"></input>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

        </div>


<?php $__env->stopSection(); ?>
<?php echo $__env->make('site.layouts.container-fluid', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>